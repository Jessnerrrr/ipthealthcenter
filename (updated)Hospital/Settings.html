<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings - Barangay Health Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        #main-header { position: fixed; top: 0; width: 100%; transition: top 0.3s ease-in-out; z-index: 50; }
        .toggle-checkbox:checked { right: 0; border-color: #0d9488; }
        .toggle-checkbox:checked + .toggle-label { background-color: #0d9488; }
        .tab-btn.active { background-color: #f0fdfa; color: #0f766e; border-left-width: 4px; border-color: #0d9488; }
        .modal { transition: opacity 0.25s ease; }
        .modal-content { transition: transform 0.25s ease; }
        body.modal-active { overflow: hidden; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 pt-[72px]">

    <header id="main-header" class="bg-white shadow-md">
        <nav class="w-full px-10 py-5 flex justify-between items-center">
            <a href="Homee.html" class="text-xl md:text-2xl font-bold text-teal-700 flex-shrink-0">Barangay Health Center</a>
            
            <div class="hidden lg:flex flex-grow justify-center gap-6 xl:gap-8 items-center">
                <a href="Homee.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">Home</a>
                <a href="about.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">About Us</a>
                <a href="services.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">Services</a>
                <a href="announcements.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">Announcements</a>
                <a href="contact.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">Contact Us</a>
                <a href="faqs.html" class="font-medium text-gray-700 hover:text-teal-600 transition duration-200">FAQs</a>
            </div>
            
            <div class="flex-shrink-0 flex gap-4 items-center">
                <button class="open-appointment-modal bg-gradient-to-r from-teal-600 to-teal-700 text-white px-5 py-2 rounded-full font-semibold hover:from-teal-700 hover:to-teal-600 transition duration-300 text-sm md:text-base shadow-md">
                    Book Now
                </button>

                <div class="relative hidden lg:block">
                    <button type="button" id="user-menu-button" class="flex items-center justify-center rounded-full bg-teal-100 p-1 hover:ring-2 hover:ring-teal-500 transition focus:outline-none">
                        <img id="header-profile-img" class="h-9 w-9 rounded-full object-cover" src="https://placehold.co/100x100/teal/white?text=User" alt="User Profile">
                    </button>
                    <div id="user-dropdown-menu" class="hidden absolute right-0 z-50 mt-2 w-56 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transform opacity-0 scale-95 transition ease-out duration-100">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-sm text-gray-500">Signed in as</p>
                            <p id="dropdown-email" class="text-sm font-bold text-gray-900 truncate">loading...</p>
                        </div>
                        <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-teal-50 hover:text-teal-700">My Profile</a>
                        <a href="my_appointments.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-teal-50 hover:text-teal-700">My Appointments</a>
                        <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-teal-50 hover:text-teal-700">Settings</a>
                        <div class="border-t border-gray-100 my-1"></div>
                        <a href="#" onclick="logoutUser()" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Sign out</a>
                    </div>
                </div>

                <button id="mobile-menu-toggle" class="lg:hidden text-gray-700 hover:text-teal-600 p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path id="menu-icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="lg:hidden hidden bg-white w-full shadow-lg absolute top-full left-0 z-40 border-t border-gray-200">
            <div class="bg-teal-50 p-4 flex items-center gap-3 border-b border-teal-100">
                <img id="mobile-profile-img" class="h-10 w-10 rounded-full object-cover border border-teal-200" src="https://placehold.co/100x100/teal/white?text=User" alt="User">
                <div>
                    <p id="mobile-name" class="text-sm font-bold text-gray-800">User</p>
                    <p id="mobile-email" class="text-xs text-gray-600">user@email.com</p>
                </div>
            </div>
            <div class="flex flex-col p-4 gap-2">
                <a href="Homee.html" class="block px-4 py-2 text-gray-700 hover:bg-teal-50 rounded-md font-medium">Home</a>
                <a href="profile.html" class="block px-4 py-2 text-gray-700 hover:bg-teal-50 rounded-md font-medium">My Profile</a>
                <a href="my_appointments.html" class="block px-4 py-2 text-gray-700 hover:bg-teal-50 rounded-md font-medium">Appointments</a>
                <a href="#" onclick="logoutUser()" class="block px-4 py-2 text-red-600 hover:bg-red-50 rounded-md font-medium">Sign Out</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12 max-w-6xl">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Account Settings</h1>
            <p class="text-gray-500 mt-1">Manage your profile details and preferences.</p>
        </div>

        <div class="flex flex-col md:flex-row gap-8">
            <aside class="w-full md:w-64 flex-shrink-0">
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                    <nav class="flex flex-col">
                        <button onclick="switchTab('general')" id="tab-general" class="tab-btn active text-left px-6 py-4 font-medium text-sm hover:bg-gray-50 transition border-l-4 border-transparent">General Information</button>
                        <button onclick="switchTab('security')" id="tab-security" class="tab-btn text-left px-6 py-4 font-medium text-sm text-gray-600 hover:bg-gray-50 transition border-l-4 border-transparent">Login & Security</button>
                        <button onclick="switchTab('notifications')" id="tab-notifications" class="tab-btn text-left px-6 py-4 font-medium text-sm text-gray-600 hover:bg-gray-50 transition border-l-4 border-transparent">Notifications</button>
                    </nav>
                </div>
            </aside>

            <div class="flex-1">
                <div id="content-general" class="settings-content space-y-6">
                    
                    <form id="general-settings-form" class="space-y-6">
                        
                        <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">Profile Photo</h2>
                            <div class="flex items-center gap-6">
                                <img id="settings-profile-preview" class="h-20 w-20 rounded-full object-cover ring-4 ring-gray-50" src="https://placehold.co/100x100/teal/white?text=User" alt="Current profile photo">
                                <div>
                                    <input type="file" id="file-upload" class="hidden" accept="image/png, image/jpeg, image/jpg">
                                    <div class="flex gap-2">
                                        <button id="change-photo-btn" type="button" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition">Change Photo</button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">JPG, GIF or PNG. Max size of 100MB.</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6">
                            <h2 class="text-lg font-semibold text-gray-900 mb-4">Personal Details</h2>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                        <input id="input-firstname" type="text" value="Juan" class="w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm py-2 px-3 border">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                        <input id="input-lastname" type="text" value="Dela Cruz" class="w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm py-2 px-3 border">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                                        <input id="input-email" type="email" value="juan.delacruz@email.com" class="w-full rounded-md border-gray-300 bg-gray-50 text-gray-500 shadow-sm sm:text-sm py-2 px-3 border cursor-not-allowed" disabled>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                        <input id="input-phone" type="tel" value="0917 123 4567" class="w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm py-2 px-3 border">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Barangay Address</label>
                                    <input id="input-address" type="text" value="Block 5, Lot 2, Mabuhay Street" class="w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm py-2 px-3 border">
                                </div>
                                
                                <div class="pt-4 flex justify-end">
                                    <button type="submit" id="main-save-btn" class="bg-teal-600 text-white px-6 py-2 rounded-md font-medium text-sm hover:bg-teal-700 shadow-sm transition">
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>
                
                <div id="content-security" class="settings-content hidden space-y-6"><div class="p-6 bg-white rounded shadow text-gray-500">Security Settings Placeholder</div></div>
                <div id="content-notifications" class="settings-content hidden space-y-6"><div class="p-6 bg-white rounded shadow text-gray-500">Notification Settings Placeholder</div></div>
            </div>
        </div>
    </main>

    <div id="appointment-modal" class="modal fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100] opacity-0 pointer-events-none">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-70"></div>
        <div class="modal-content bg-white rounded-xl shadow-2xl z-[110] w-11/12 md:max-w-xl mx-auto transform -translate-y-10 scale-95 border-t-4 border-teal-600">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-2xl font-bold text-teal-800">Book an Appointment</h3>
                <button class="modal-close p-2 -mr-2 rounded-full hover:bg-gray-100"><svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="p-6">
                <form id="booking-form" action="#" method="POST" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700">Full Name</label><input type="text" id="full-name-modal" value="Juan Dela Cruz" readonly class="mt-1 block w-full border border-gray-200 bg-gray-50 rounded-lg shadow-sm p-3 text-gray-600 cursor-not-allowed"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Contact Number</label><input type="tel" value="0917-123-4567" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:border-teal-500 focus:ring-teal-500"></div>
                        <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">Service Needed</label><select id="service-modal" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 bg-white focus:border-teal-500 focus:ring-teal-500"><option>Select a service</option><option>General Consultation</option><option>Vaccination</option><option>Prenatal Checkup</option><option>Dental Checkup</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700">Preferred Date</label><input type="date" id="date-modal" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:border-teal-500 focus:ring-teal-500"></div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Preferred Time</label>
                            <select id="time-modal" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 bg-white focus:border-teal-500 focus:ring-teal-500">
                                <option value="">Select time</option><option value="08:00">8:00 AM - 9:00 AM</option><option value="09:00">9:00 AM - 10:00 AM</option><option value="10:00">10:00 AM - 11:00 AM</option><option value="13:00">1:00 PM - 2:00 PM</option><option value="14:00">2:00 PM - 3:00 PM</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="mt-6 w-full bg-gradient-to-r from-teal-600 to-teal-700 text-white px-8 py-3 rounded-full font-semibold hover:from-teal-700 hover:to-teal-600 transition duration-300 shadow-md">Confirm Booking</button>
                </form>
            </div>
        </div>
    </div>

    <script>
    const API_BASE_URL = 'http://localhost:8080'; 

    document.addEventListener('DOMContentLoaded', function() {
        setupHeaderDropdown();
        setupHidingHeader();
        setupMobileMenu();
        setupModals();
        setupBookingForm(); 
        setupProfileLogic(); 
    });

    function setupProfileLogic() {
        const fileInput = document.getElementById('file-upload');
        const changePhotoBtn = document.getElementById('change-photo-btn');
        const mainSaveBtn = document.getElementById('main-save-btn');
        const generalForm = document.getElementById('general-settings-form');
        const previewImage = document.getElementById('settings-profile-preview');
        
        let selectedFile = null;

        // A. Load User Data
        fetch(`${API_BASE_URL}/get-user-profile`)
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    const u = data.user;
                    
                    // Logic to split the single 'name' column into two inputs (First and Last Name)
                    if(u.name && !u.name.includes('undefined') && u.name !== 'null') {
                        const nameParts = u.name.split(' ').filter(p => p.trim() !== '');
                        document.getElementById('input-firstname').value = nameParts[0] || '';
                        document.getElementById('input-lastname').value = nameParts.slice(1).join(' ') || '';
                        
                        // Fallback to name if split is messy
                        if(nameParts.length <= 1) {
                             document.getElementById('input-firstname').value = u.name;
                             document.getElementById('input-lastname').value = '';
                        }
                    }

                    if(u.email && !u.email.includes('undefined')) {
                        document.getElementById('input-email').value = u.email;
                        if(document.getElementById('dropdown-email')) document.getElementById('dropdown-email').textContent = u.email;
                        if(document.getElementById('mobile-email')) document.getElementById('mobile-email').textContent = u.email;
                    }
                    
                    if(u.phone && !u.phone.includes('undefined')) {
                        document.getElementById('input-phone').value = u.phone;
                    }
                    
                    if(u.address && !u.address.includes('undefined')) {
                        document.getElementById('input-address').value = u.address;
                    }

                    if(u.profile_picture) {
                        const newSrc = `${API_BASE_URL}/${u.profile_picture}?t=${new Date().getTime()}`;
                        if(previewImage) previewImage.src = newSrc;
                        if(document.getElementById('header-profile-img')) document.getElementById('header-profile-img').src = newSrc;
                        if(document.getElementById('mobile-profile-img')) document.getElementById('mobile-profile-img').src = newSrc;
                    }
                }
            })
            .catch(err => console.error("Profile Load Error:", err));

        // B. Handle Image Selection
        if(changePhotoBtn && fileInput) {
            changePhotoBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                selectedFile = e.target.files[0];
                if(selectedFile) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { previewImage.src = ev.target.result; };
                    reader.readAsDataURL(selectedFile);
                }
            });
        }

        // C. Handle Main "Save Changes" Button Click (UPDATED WITH SWEETALERT)
        if(generalForm) {
            generalForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const firstName = document.getElementById('input-firstname').value;
                const lastName = document.getElementById('input-lastname').value;
                const phone = document.getElementById('input-phone').value;
                const address = document.getElementById('input-address').value;
                
                mainSaveBtn.innerText = "Saving...";
                mainSaveBtn.disabled = true;

                let overallSuccess = true;
                let errorMessage = '';

                try {
                    // 1. SAVE TEXT DATA (Must happen first)
                    const textResponse = await fetch(`${API_BASE_URL}/update-user-details`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            userId: 1, 
                            firstName: firstName, 
                            lastName: lastName, 
                            phone: phone, 
                            address: address 
                        })
                    });
                    
                    const textResult = await textResponse.json();
                    
                    if(!textResult.success) {
                        overallSuccess = false;
                        errorMessage = textResult.error || "Text details save failed.";
                        throw new Error(errorMessage);
                    }

                    // 2. SAVE IMAGE (Only if selected)
                    if(selectedFile) {
                        const formData = new FormData();
                        formData.append('profilePhoto', selectedFile);
                        formData.append('userId', 1);

                        const imgResponse = await fetch(`${API_BASE_URL}/update-profile-picture`, {
                            method: 'POST',
                            body: formData
                        });
                        const imgResult = await imgResponse.json();
                        
                        if(imgResult.success) {
                            // Force cache refresh in UI
                            const newSrc = `${API_BASE_URL}/${imgResult.imagePath}?t=${new Date().getTime()}`;
                            document.getElementById('header-profile-img').src = newSrc;
                            document.getElementById('settings-profile-preview').src = newSrc; 
                            if(document.getElementById('mobile-profile-img')) document.getElementById('mobile-profile-img').src = newSrc;
                        } else {
                            // Image upload failed, but text was saved. Report error without crashing flow.
                            console.error("Image upload failed:", imgResult.error);
                            Swal.fire({
                                icon: 'warning',
                                title: 'Partial Save',
                                text: `Text details saved, but the photo upload failed: ${imgResult.error}.`,
                            });
                        }
                    }

                    // --- SWEETALERT SUCCESS ---
                    if (overallSuccess) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Saved!',
                            text: 'Your profile changes have been successfully updated.',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    }

                } catch(err) {
                    console.error("Save Error:", err);
                    // --- SWEETALERT ERROR ---
                    Swal.fire({
                        icon: 'error',
                        title: 'Save Failed',
                        text: `Could not save changes. Error: ${err.message}. Please ensure your database columns are correct.`,
                    });
                } finally {
                    mainSaveBtn.innerText = "Save Changes";
                    mainSaveBtn.disabled = false;
                    selectedFile = null;
                }
            });
        }
    }

    // function setupBookingForm() { ... } (Keep existing logic)
    function setupBookingForm() {
        const form = document.getElementById('booking-form');
        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const service = document.getElementById('service-modal').value;
                const dateVal = document.getElementById('date-modal').value;
                const time = document.getElementById('time-modal').value; 

                if(service.includes('Select') || !dateVal || !time) {
                    Swal.fire({
                         icon: 'warning',
                         title: 'Missing Fields',
                         text: 'Please fill in all appointment fields.',
                    }); 
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/book-appointment`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            patient_id: 1, 
                            appointment_date: dateVal + " " + time + ":00", 
                            reason: service 
                        })
                    });
                    const result = await response.json();
                    if (result.success) {
                        Swal.fire({
                             icon: 'success',
                             title: 'Appointment Booked!',
                             text: 'Your appointment is pending approval.',
                             showConfirmButton: false,
                             timer: 2500
                        });
                        toggleModal(document.getElementById('appointment-modal'), false);
                        form.reset();
                    } else { 
                        Swal.fire({
                             icon: 'error',
                             title: 'Booking Failed',
                             text: 'Error: ' + (result.error || 'Server error.'),
                        });
                    }
                } catch(error) { 
                    console.error("Booking Error:", error); 
                    Swal.fire({
                         icon: 'error',
                         title: 'Connection Failed',
                         text: 'Could not connect to the server to book the appointment.',
                    });
                }
            });
        }
    }


    // --- LOGOUT FUNCTION (Uses SweetAlert2) ---
    function logoutUser() {
        Swal.fire({
            title: 'Sign Out?',
            text: "You will be redirected to the home page.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#047857', // teal-600
            cancelButtonColor: '#ef4444', // red-500
            confirmButtonText: 'Yes, Sign Out'
        }).then((result) => {
            if (result.isConfirmed) {
                // 1. Clear any saved session data
                localStorage.removeItem('userType'); 
                localStorage.removeItem('isLoggedIn');
                
                // 2. Redirect
                window.location.href = "Homee.html"; 
            }
        });
    }

    // --- Existing Helper Functions (No changes needed) ---
    function switchTab(tabName) {
        document.querySelectorAll('.settings-content').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active', 'text-teal-700', 'bg-teal-50');
            btn.classList.add('text-gray-600');
        });
        document.getElementById('content-' + tabName).classList.remove('hidden');
        const activeBtn = document.getElementById('tab-' + tabName);
        activeBtn.classList.add('active', 'text-teal-700', 'bg-teal-50');
        activeBtn.classList.remove('text-gray-600');
    }
    function toggleModal(modal, show) {
        if (!modal) return;
        const content = modal.querySelector('.modal-content');
        const body = document.querySelector('body');
        if (show) {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            content.classList.remove('-translate-y-10', 'scale-95');
            body.classList.add('modal-active');
        } else {
            modal.classList.add('opacity-0');
            content.classList.add('-translate-y-10', 'scale-95');
            setTimeout(() => { modal.classList.add('pointer-events-none'); body.classList.remove('modal-active'); }, 250);
        }
    }
    function setupModals() {
        const modal = document.getElementById('appointment-modal');
        document.querySelectorAll('.open-appointment-modal').forEach(btn => btn.addEventListener('click', (e) => { e.preventDefault(); toggleModal(modal, true); }));
        document.querySelectorAll('.modal-close, .modal-overlay').forEach(btn => btn.addEventListener('click', (e) => { e.preventDefault(); toggleModal(modal, false); }));
    }
    function setupHeaderDropdown() {
        const btn = document.getElementById('user-menu-button');
        const menu = document.getElementById('user-dropdown-menu');
        if(btn && menu) {
            btn.addEventListener('click', (e) => { e.stopPropagation(); menu.classList.toggle('hidden'); menu.classList.toggle('opacity-0'); menu.classList.toggle('scale-95'); });
            window.addEventListener('click', (e) => { if(!btn.contains(e.target)) { menu.classList.add('hidden'); menu.classList.add('opacity-0'); } });
        }
    }
    function setupHidingHeader() {
        const header = document.getElementById('main-header');
        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop && scrollTop > header.offsetHeight) { header.style.top = `-${header.offsetHeight}px`; } 
            else { header.style.top = '0'; }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        });
    }
    function setupMobileMenu() {
        document.getElementById('mobile-menu-toggle')?.addEventListener('click', () => { document.getElementById('mobile-menu').classList.toggle('hidden'); });
    }
    </script>
</body>
</html>